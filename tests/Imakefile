DEPEND = sh ./depend.sh

CXXPATH=$(shell echo $$CLANGPATH)

INCLUDES = -I$(TOP)/include -I$(ZEN)/include -I$(ALEPHW) 
WARN= -Wall -Wextra -Wcast-align -Wno-sign-compare -Wno-write-strings\
	-Wno-parentheses

#OPTFLAGS = -Ofast -DNDEBUG
OPTFLAGS = -O0 -g
FLAGS = -std=c++14 $(WARN) $(OPTFLAGS)
#FLAGS = -std=c++14 $(WARN) -Ofast -DNDEBUG

GENCORR = $(TOP)/bin/gen-def-corr

.SUFFIXES: .rb

.rb.H: $(GENCORR)
	$(RM) $*.H; 	\	@@\
	$(GENCORR) -f $*.rb -H | clang-format -style=Mozilla > $@

rs-corr.H: $(TOP)/include/correlations/solution-gas-oil-relation.rb\
	$(TOP)/include/correlations/undersaturated-solution-gas-oil-relation.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/solution-gas-oil-relation.rb \
	-2 $(TOP)/include/correlations/undersaturated-solution-gas-oil-relation.rb\
	-n RsCorr | clang-format -style=Mozilla > $@

bo-corr.H: $(TOP)/include/correlations/saturated-oil-formation-volume-factor.rb\
	$(TOP)/include/correlations/undersaturated-oil-formation-volume-factor.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-oil-formation-volume-factor.rb\
	-2 $(TOP)/include/correlations/undersaturated-oil-formation-volume-factor.rb\
	-n BoCorr | clang-format -style=Mozilla > $@

co-corr.H: $(TOP)/include/correlations/saturated-oil-compressibility.rb\
	$(TOP)/include/correlations/undersaturated-oil-compressibility.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-oil-compressibility.rb \
	-2 $(TOP)/include/correlations/undersaturated-oil-compressibility.rb\
	-n CoCorr | clang-format -style=Mozilla > $@

uo-corr.H: $(TOP)/include/correlations/saturated-oil-viscosity.rb\
	$(TOP)/include/correlations/undersaturated-oil-viscosity.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-oil-viscosity.rb \
	-2 $(TOP)/include/correlations/undersaturated-oil-viscosity.rb\
	-n UoCorr | clang-format -style=Mozilla > $@

po-corr.H: $(TOP)/include/correlations/saturated-oil-density.rb\
	$(TOP)/include/correlations/undersaturated-oil-density.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-oil-density.rb \
	-2 $(TOP)/include/correlations/undersaturated-oil-density.rb\
	-n PoCorr | clang-format -style=Mozilla > $@

bw-corr.H: $(TOP)/include/correlations/saturated-water-volume-factor.rb\
	$(TOP)/include/correlations/undersaturated-water-volume-factor.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-water-volume-factor.rb \
	-2 $(TOP)/include/correlations/undersaturated-water-volume-factor.rb\
	-n BwCorr | clang-format -style=Mozilla > $@

cw-corr.H: $(TOP)/include/correlations/saturated-water-isothermal-compressibility.rb\
	$(TOP)/include/correlations/undersaturated-water-isothermal-compressibility.rb
	$(RM)  $@;	\	@@\
	$(GENCORR) -1 $(TOP)/include/correlations/saturated-water-isothermal-compressibility.rb \
	-2 $(TOP)/include/correlations/undersaturated-water-isothermal-compressibility.rb\
	-n CwCorr | clang-format -style=Mozilla > $@

clean::
	$(RM) rs-corr.H bo-corr.H co-corr.H uo-corr.H po-corr.H cw-corr.H bw-corr.H 

test-compound-call.o:  bo-corr.H

tplot.o: rs-corr.H bo-corr.H co-corr.H uo-corr.H po-corr.H cw-corr.H bw-corr.H 

CORRS = $(shell ls $(DIR)*.rb)
HCORRS = $(CORRS:.rb=.H)

OPTIONS = $(FLAGS)
CXXFLAGS= -std=c++14 $(INCLUDES) $(OPTIONS)

SYS_LIBRARIES =-L$(ZEN)/lib -lzen -L$(ALEPHW) -lAleph  -lstdc++ -lgsl -lgslcblas -lm -lc

DEPLIBS	= $(TOP)/lib/libpvt.a 

LOCAL_LIBRARIES = $(TOP)/lib/libpvt.a

TESTSRCS = test-all-units-1.cc test-conversion.cc test-corr.cc test-seq.cc \
	test-biblio.cc test-json.cc test-tuning.cc test-analyse.cc \
	test-empirical-json.cc test-fluid-analysis.cc test-cali.cc\
	test-def-corr.cc test-calibrate.cc test-par.cc plot.cc cplot.cc \
	test-exception.cc vector-conversion.cc test-pvt-data.cc test-adjust.cc \
	tplot.cc test-simple-call.cc test-compound-call.cc

TESTOBJS = $(TESTSRCS:.cc=.o)

SRCS = $(TESTSRCS)

AllTarget(test-conversion)
NormalProgramTarget(test-conversion,test-conversion.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(vector-conversion)
NormalProgramTarget(vector-conversion,vector-conversion.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-exception)
NormalProgramTarget(test-exception,test-exception.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-corr)
NormalProgramTarget(test-corr,test-corr.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))
AllTarget(test-all-units-1)
NormalProgramTarget(test-all-units-1,test-all-units-1.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-seq)
NormalProgramTarget(test-seq,test-seq.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-biblio)
NormalProgramTarget(test-biblio,test-biblio.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-json)
NormalProgramTarget(test-json,test-json.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-tuning)
NormalProgramTarget(test-tuning,test-tuning.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-analyse)
NormalProgramTarget(test-analyse,test-analyse.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-empirical-json)
NormalProgramTarget(test-empirical-json,test-empirical-json.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-def-corr)
NormalProgramTarget(test-def-corr,test-def-corr.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-calibrate)
NormalProgramTarget(test-calibrate,test-calibrate.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-par)
NormalProgramTarget(test-par,test-par.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(plot)
NormalProgramTarget(plot,plot.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(cplot)
NormalProgramTarget(cplot,cplot.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(tplot)
NormalProgramTarget(tplot,tplot.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-pvt-data)
NormalProgramTarget(test-pvt-data,test-pvt-data.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-adjust)
NormalProgramTarget(test-adjust,test-adjust.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-cali)
NormalProgramTarget(test-cali,test-cali.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-simple-call)
NormalProgramTarget(test-simple-call,test-simple-call.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))

AllTarget(test-compound-call)
NormalProgramTarget(test-compound-call,test-compound-call.o,$(DEPLIBS),$(LOCAL_LIBRARIES),$(SYS_LIBRARIES))


DependTarget()
