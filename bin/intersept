#!/usr/bin/env ruby
# -*- coding: iso-8859-1 -*-

=begin
 Simple set intersection calculator

 Aleph-w Leandro Rabindranath Leon
=end

require 'fileutils'
require 'optparse'
require 'set'

pvtdir = ENV['PVT']
fail 'PVT env var has not been defined' unless pvtdir

class Class

  attr_reader :name, :members

  def initialize name
    @name = name
    @members = Set.new
  end

  def add_members(*names)
    names.each {|name| @members.add name }
  end
  
end

$classes = []
$curr_class = nil

def add_class name
  $curr_class = Class.new(name)
  $classes << $curr_class
end

def add_members(*names)
  $curr_class.add_members(*names)
end

def common_names
  i = $classes.map { |c| c.members }.inject { |s1, s2| s1 & s2 }
  i.to_a
end


options = {}
options_parser = OptionParser.new do |opts|

  opts.on('-f NAME', '--file NAME', 
          'file name with correlations') do |file_name|
    options[:file_name] = file_name
  end
  
end

options_parser.parse!

file = options[:file_name]
load file

$guard_name = File.basename file, '.rb'

$classes.each do |c|
  puts c.name
  puts c.members
end

puts common_names
